<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Management</title>
    <link rel="icon" type="image/png" href="./favicon.png">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.css">
    <script src="https://cdn.jsdelivr.net/npm/frappe-gantt@0.6.1/dist/frappe-gantt.min.js"></script>
</head>

<body>
    <div class="page-container">
        <nav class="navbar">
            <a href="#" class="nav-brand" id="nav-brand-link">
                <img src="./Images/Logo.png" alt="Momentum Logo" style="height: 40px;">
                <div class="brand-text">
                    <span class="brand-title">Momentum</span>
                    <span class="brand-subtitle">Construction Management</span>
                </div>
            </a>
            <ul>
                <li><a href="#" id="nav-dashboard">Dashboard</a></li>
                <li><a href="#" id="nav-projects">Projects</a></li>
                <li class="dropdown">
                    <a href="#" class="dropbtn" id="nav-libraries">Libraries</a>
                    <div class="dropdown-content">
                        <a href="#" id="nav-materials-library">Materials Library</a>
                        <a href="#" id="nav-dupa-library">DUPA Labor & Equipment</a>
                        <a href="#" id="nav-library-management">Import/Export Library</a>
                    </div>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropbtn" id="nav-settings">Settings</a>
                    <div class="dropdown-content">
                        <a href="#" id="nav-sync-settings">Sync Settings</a>
                        <a href="#" id="nav-data-management">Data Management</a>
                    </div>
                </li>
                <li><a href="#" id="nav-documentation">User Manual</a></li>
                <li>
                    <button id="google-auth-btn" class="google-btn">
                        <svg class="google-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48">
                            <path fill="#4285F4" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"/>
                            <path fill="#34A853" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C42.612,36.845,44,34.135,44,31C44,27.202,42.748,23.827,40.611,21.083z"/>
                            <path fill="#FBBC05" d="M9.803,26.371l6.19,5.238c1.856-1.405,3.295-3.334,4.087-5.571H24v-8H9.803c-1.258,2.843-1.258,6.157,0,9C9.803,26.37,9.803,26.371,9.803,26.371z"/>
                            <path fill="#EA4335" d="M24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C17.38,4,11.522,8.583,9.023,14.925l6.774,5.404C17.352,16.191,20.444,12,24,12z"/>
                        </svg>
                        <span class="google-btn-text">Sign In with Google</span>
                    </button>
                </li>
            </ul>
        </nav>

        <main class="content">
            <main class="content">
            <div id="settings-view" class="hidden">
                <header class="page-header">
                    <h1>Settings</h1>
                </header>
                <div class="summary-card" style="text-align: left; max-width: 600px;">
                    <h2 class="card-title">Google Drive Synchronization</h2>
                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="auto-sync-toggle">Enable Auto-Sync</label>
                            <p>Automatically save any modified project to Google Drive in the background.</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="auto-sync-toggle">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">
                            <label for="auto-sync-interval">Sync Interval</label>
                            <p>How often to check for and save modified projects.</p>
                        </div>
                        <select id="auto-sync-interval" class="btn btn-secondary">
                            <option value="1">Every 1 Minute</option>
                            <option value="5" selected>Every 5 Minutes</option>
                            <option value="15">Every 15 Minutes</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="dashboard-view">
                <header class="page-header">
                    <h1>Dashboard</h1>
                </header>
                <div class="dashboard-grid-new">
                        <div class="summary-card">
                            <h2 class="card-title">On-Going Projects</h2>
                            <p id="ongoing-project-count">0</p>
                        </div>
                        <div class="summary-card">
                            <h2 class="card-title">Completed Projects</h2>
                            <p id="completed-project-count">0</p>
                        </div>
                        <div class="summary-card">
                            <h2 class="card-title">Pending Change Orders</h2>
                            <p id="pending-co-count">0</p>
                        </div>
                        <div class="summary-card">
                            <h2 class="card-title">Value of Active Projects</h2>
                            <p id="active-contract-value">‚Ç±0</p>
                        </div>
                        <div class="dashboard-chart-container">
                            <h2 class="card-title">Projects by Status</h2>
                            <canvas id="project-status-chart"></canvas>
                        </div>
                        <div class="dashboard-list-container">
                            <h2 class="card-title">Projects Requiring Attention</h2>
                            <ul id="attention-projects-list"></ul>
                        </div>
                </div>
                    <div class="dashboard-gantt-container">
                    <div class="page-header" style="margin-bottom: 1rem;">
                        <h2 class="card-title" style="margin-bottom: 0;">Ongoing Project Timelines</h2>
                        <div class="gantt-controls">
                            <div class="form-group" style="margin-bottom: 0;">
                            <select id="dashboard-gantt-sort" class="btn btn-secondary">
                                <option value="start_date">Sort by Start Date</option>
                                <option value="name">Sort by Name</option>
                                <option value="progress">Sort by Progress</option>
                            </select>
                            </div>
                            <span>View Mode:</span>
                            <button id="dashboard-gantt-view-day" class="btn btn-secondary">Day</button>
                            <button id="dashboard-gantt-view-week" class="btn btn-secondary">Week</button>
                            <button id="dashboard-gantt-view-month" class="btn btn-secondary">Month</button>
                        </div>
                    </div>
                    <div class="gantt-chart-container" id="dashboard-gantt-chart-target"></div>
                    </div>
            </div>
            <div id="documentation-view" class="hidden">
                <header class="page-header">
                    <h1>Momentum: A Quick Start Guide</h1>
                </header>
                
                <p style="text-align: center; font-size: 1.1rem; color: var(--grey-color);">Welcome to Momentum! Follow these key phases to take your project from plan to completion.</p>

                <div class="manual-card-grid">

                    <div class="manual-card">
                        <h4>‚öôÔ∏è 1. Setup: Your Foundation</h4>
                        <ul>
                            <li>Begin on the <strong>Projects</strong> page to create a new project, filling in its core details.</li>
                            <li><strong>Pro-Tip:</strong> Before planning, visit the <strong>Libraries</strong> (top menu) to pre-populate common Materials, Resources (Labor/Equipment), and even pre-defined construction Crews.</li>
                            <li>A well-stocked library makes the cost estimation process significantly faster and more consistent.</li>
                        </ul>
                    </div>

                    <div class="manual-card">
                        <h4>üìê 2. Pre-construction: The Blueprint</h4>
                        <ul>
                            <li>The <strong>Project Workspace</strong> is your central hub for managing a single project.</li>
                            <li><strong>Take Off:</strong> Define your project's scope by adding every work item. Use categories to keep things organized and break down complex items with <strong>sub-quantities</strong>.</li>
                            <li><strong>DUPA:</strong> For each item, perform a Detailed Unit Price Analysis. Add labor, materials, and equipment from your libraries or create them on the fly.</li>
                            <li><strong>Task Sequencing:</strong> Create the project's logical workflow by defining which tasks must come before others (predecessors and successors).</li>
                        </ul>
                    </div>

                    <div class="manual-card critical">
                        <h4>üîë 3. The Critical Step: Locking the Plan</h4>
                        <ul>
                            <li>This is the most important step in the workflow. From the workspace, open the <strong>Baseline Reports</strong> module.</li>
                            <li>You will be prompted to <strong>Generate a Bill of Quantities (BOQ)</strong>.</li>
                            <li>This action <strong>locks</strong> all your pre-construction data (Take Off, DUPA, Sequencing), creating the official project baseline against which all future progress is measured.</li>
                            <li>Once the BOQ is locked, all <strong>Construction</strong> and <strong>Tracking</strong> modules for the project become enabled.</li>
                        </ul>
                    </div>

                    <div class="manual-card">
                        <h4>üèóÔ∏è 4. Construction: Tracking Progress</h4>
                        <ul>
                            <li>Begin by opening the <strong>Accomplishment</strong> module. Your first report will prompt you to set the project's official <strong>Start Date</strong>, which anchors the entire construction schedule.</li>
                            <li>File progress reports regularly by entering the percentage of work completed for each task.</li>
                            <li>Monitor project health in real-time using the <strong>Tracking Gantt</strong> and <strong>Tracking S-Curve</strong> to visually compare your actual progress against the planned baseline.</li>
                        </ul>
                    </div>

                    <div class="manual-card">
                        <h4>üìã 5. Handling Changes: Staying Agile</h4>
                        <ul>
                            <li>Use the <strong>Change Orders</strong> module to formally document any variation or change in scope.</li>
                            <li>Items can be additive (new work) or deductive (removed work).</li>
                            <li>Once a Change Order's status is set to <strong>"Approved,"</strong> its tasks and costs are automatically integrated into the project.</li>
                            <li>View the impact of these changes on the schedule and budget in the <strong>Revised Reports</strong> module.</li>
                        </ul>
                    </div>

                                        <div class="manual-card">
                        <h4>üíæ 6. Data Management: Import & Export</h4>
                        <ul>
                            <li>All your data is saved automatically in your browser's local storage‚Äîno internet connection is required.</li>
                            <li>To create a backup or move data, use the <strong>Export Project</strong> button on the main Projects page. This saves a single project and all its related data to a <strong>.json</strong> file.</li>
                            <li>To manage your library, go to <strong>Libraries > Import/Export Library</strong>. This allows you to save or load your entire collection of materials, resources, and crews.</li>
                        </ul>
                    </div>

                    <div class="manual-card">
                        <h4>‚òÅÔ∏è 7. Google Drive Integration</h4>
                        <ul>
                            <li>Click the <strong>"Sign In with Google"</strong> button in the top navigation bar to connect your Google account.</li>
                            <li><strong>To save a project or your library,</strong> use the "Export to Google Drive" button. The first time you save, a folder named <strong>"momentum-projects"</strong> will be created in your Drive.</li>
                            <li>If a file already exists, you will be prompted to either <strong>overwrite</strong> it or save a new version with a "(copy)" suffix.</li>
                            <li><strong>To load a project or library,</strong> use the "Import from Google Drive" button. A window will appear showing only the `.json` files inside your "momentum-projects" folder.</li>
                        </ul>
                    </div>

                    <div class="manual-card">
                        <h4>‚öôÔ∏è 8. Settings & Auto-Sync</h4>
                        <ul>
                            <li>Access the settings page from the new <strong>Settings > Sync Settings</strong> dropdown in the navigation bar.</li>
                            <li>You can enable <strong>Auto-Sync</strong> to have the application automatically save any modified projects to Google Drive in the background.</li>
                            <li>For this feature to work, you must be signed in to your Google Account.</li>
                            <li>You can also configure the sync interval (e.g., every 1, 5, or 15 minutes).</li>
                        </ul>
                    </div>

                </div>
            </div>

            <div id="projects-view" class="hidden">
                <header class="page-header">
                    <h1>Projects</h1>
                    <div>
                        <input type="file" id="import-project-input" class="hidden" accept=".json">
                        <button id="import-project-btn" class="btn btn-secondary">Import from File</button>
                        <button id="import-gdrive-btn" class="btn btn-secondary">Import from Drive</button>
                        <button id="copy-project-btn" class="btn btn-secondary">Copy Project</button>
                        <button id="add-project-btn" class="btn btn-primary">Add New Project</button>
                    </div>
                </header>
                <div class="table-container">
                    <table id="projects-table">
                        <thead>
                            <tr>
                                <th>Project Name</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div id="project-summary-view" class="hidden">
                <header class="page-header">
                    <button id="back-to-projects-from-summary" class="btn btn-secondary">&larr; Back to Projects List</button>
                </header>

                <div class="project-dashboard-layout">
                    <div class="project-dashboard-header">
                        <h1 id="summary-project-name"></h1>
                        <p id="summary-description-subtitle" class="page-subtitle"></p>

                        <div class="summary-progress-bar-container">
                            <div class="progress-bar-labels">
                                <label>Overall Progress</label>
                                <span id="summary-progress-percent">0%</span>
                            </div>
                            <progress id="summary-progress-bar" value="0" max="100"></progress>
                        </div>

                        <div class="kpi-card-grid">
                            <div class="kpi-card">
                                <label>Status</label>
                                <span id="kpi-status" class="kpi-value"></span>
                            </div>
                            <div class="kpi-card">
                                <label>Contract Amount</label>
                                <span id="kpi-contract-amount" class="kpi-value"></span>
                            </div>
                            <div class="kpi-card">
                                <label>Days Remaining</label>
                                <span id="kpi-days-remaining" class="kpi-value"></span>
                            </div>
                            <div class="kpi-card">
                                <label>Project Manager</label>
                                <span id="kpi-project-manager" class="kpi-value"></span>
                            </div>
                        </div>
                    </div>
                    <div class="summary-secondary-details">
                            <h4>Additional Information</h4>
                            <div class="summary-grid">
                                <div class="summary-item"><strong>Client</strong> <span id="secondary-client-name"></span></div>
                                <div class="summary-item"><strong>Client Contact</strong> <span id="secondary-client-contact"></span></div>
                                <div class="summary-item"><strong>Address</strong> <span id="secondary-address"></span></div>
                                <div class="summary-item"><strong>Contract Date</strong> <span id="secondary-contract-date"></span></div>
                                <div class="summary-item"><strong>Target Start Date</strong> <span id="secondary-target-start"></span></div>
                                <div class="summary-item"><strong>Contract Duration</strong> <span id="secondary-duration"></span></div>
                                <div class="summary-item"><strong>Lot Area</strong> <span id="secondary-lot-area"></span></div>
                                <div class="summary-item"><strong>Floor Area</strong> <span id="secondary-floor-area"></span></div>
                                <div class="summary-item"><strong>Number of Floors</strong> <span id="secondary-floors"></span></div>
                            </div>
                        </div>

                    <div class="project-dashboard-hub">
                        <div class="hub-section">
                            <h3>Pre-construction</h3>
                            <div class="hub-buttons">
                                <button id="hub-btn-takeoff" class="btn btn-primary">
                                    <div class="hub-button-content">
                                        <div class="hub-button-header"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M15.5 2a.5.5 0 0 0-.5-.5h-13a.5.5 0 0 0 0 1h13a.5.5 0 0 0 .5-.5zM12 3v2h2v-2h-2zm-2 2v-2h2v2h-2zm-2 0v-2h2v2h-2zm-2 0v-2h2v2H6zm-2 0v-2h2v2H4zM2 3v2h2v-2H2zm13.5 3a.5.5 0 0 0-.5-.5h-13a.5.5 0 0 0 0 1h13a.5.5 0 0 0 .5-.5z"/></svg> <span>Take Off</span></div>
                                        <span class="hub-button-desc">Define the project's scope of work and item quantities.</span>
                                    </div>
                                </button>
                                <button id="hub-btn-dupa" class="btn btn-primary">
                                    <div class="hub-button-content">
                                        <div class="hub-button-header"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h8zM4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4z"/><path d="M4 2.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-2zm0 4a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm3-6a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-4z"/></svg> <span>DUPA</span></div>
                                        <span class="hub-button-desc">Analyze unit costs for labor, materials, and equipment.</span>
                                    </div>
                                </button>
                                <button id="hub-btn-sequencing" class="btn btn-primary">
                                    <div class="hub-button-content">
                                        <div class="hub-button-header"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-diagram-3" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6h-1A1.5 1.5 0 0 1 6 4.5v-1zM7.5 3a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-1zM5 10.5A1.5 1.5 0 0 1 6.5 9h3A1.5 1.5 0 0 1 11 10.5v1A1.5 1.5 0 0 1 9.5 13h-3A1.5 1.5 0 0 1 5 11.5v-1zM6.5 10a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-3zM3 10.5a.5.5 0 0 0-1 0v1a.5.5 0 0 0 1 0v-1zm10 0a.5.5 0 0 1 1 0v1a.5.5 0 0 1-1 0v-1z"/><path d="M5.5 13a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0v-1a.5.5 0 0 1 .5-.5zm5 0a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0v-1a.5.5 0 0 1 .5-.5z"/><path d="M5 11.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 .5.5V13h-1V12h-1v1H5v-.5z"/></svg> <span>Task Sequencing</span></div>
                                        <span class="hub-button-desc">Set task dependencies to build the project schedule.</span>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <div class="hub-section">
                            <h3>Construction</h3>
                            <div class="hub-buttons">
                                <button id="hub-btn-change-orders" class="btn btn-primary construction-phase-btn" disabled>
                                     <div class="hub-button-content">
                                        <div class="hub-button-header"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"/><path d="M8.5 4.5V6H10a.5.5 0 0 1 0 1H8.5v1.5a.5.5 0 0 1-1 0V7H6a.5.5 0 0 1 0-1h1.5V4.5a.5.5 0 0 1 1 0zm-2 7a.5.5 0 0 1 0-1h5a.5.5 0 0 1 0 1h-5z"/></svg> <span>Change Orders</span></div>
                                        <span class="hub-button-desc">Manage variation orders and scope modifications.</span>
                                    </div>
                                </button>
                                <button id="hub-btn-accomplishment" class="btn btn-primary construction-phase-btn" disabled>
                                    <div class="hub-button-content">
                                        <div class="hub-button-header"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M10.854.146a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L3.5 6.793l6.646-6.647a.5.5 0 0 1 .708 0z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0v-1a.5.5 0 0 1 .5-.5h-3a.5.5 0 0 1 0-1h3z"/></svg> <span>Accomplishment</span></div>
                                        <span class="hub-button-desc">File daily progress reports to track work completion.</span>
                                    </div>
                                </button>
                                <button id="hub-btn-tracking-gantt" class="btn btn-primary construction-phase-btn" disabled>
                                    <div class="hub-button-content">
                                        <div class="hub-button-header"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5h1zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/><path d="M3 6.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5z"/></svg> <span>Tracking Gantt</span></div>
                                        <span class="hub-button-desc">Visualize planned vs. actual schedule progress.</span>
                                    </div>
                                </button>
                                <button id="hub-btn-tracking-scurve" class="btn btn-primary construction-phase-btn" disabled>
                                    <div class="hub-button-content">
                                        <div class="hub-button-header"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M0 5.013C0 4.453.448 4 1 4c.435 0 .825.277 1.25.438C3.58 4.965 5.26 6.38 7.29 6.84c1.94.437 3.51-.59 4.75-1.78C13.2 4.102 14.03 3.5 15 3.5c.552 0 1 .453 1 1.013v.355C16 5.453 15.552 6 15 6c-.435 0-.825-.277-1.25-.438-1.32-.497-2.99-.034-4.24 1.154-1.94.437-3.51.59-4.75 1.78C3.8 9.898 2.97 10.5 2 10.5c-.552 0-1-.453-1-1.013v-.355z"/></svg> <span>Tracking S-Curve</span></div>
                                        <span class="hub-button-desc">Compare planned vs. actual completion rate over time.</span>
                                    </div>
                                </button>
                            </div>
                        </div>
                        
                        <div class="hub-section">
                            <h3>Reports</h3>
                            <div class="hub-buttons">
                                <button id="hub-btn-reports" class="btn btn-outline-primary">
                                    <div class="hub-button-content">
                                        <div class="hub-button-header"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.5 2A1.5 1.5 0 0 1 6 3.5v9A1.5 1.5 0 0 1 4.5 14h-2A1.5 1.5 0 0 1 1 12.5v-9A1.5 1.5 0 0 1 2.5 2h2zm2 0A1.5 1.5 0 0 1 8 3.5v9A1.5 1.5 0 0 1 6.5 14h-2v-1h2a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-2v-1h2z"/><path d="M2.5 1a.5.5 0 0 0 0 1h11a.5.5 0 0 0 0-1h-11zm9 3.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-2zm0 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-2zm0 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-2z"/></svg> <span>Baseline Reports</span></div>
                                        <span class="hub-button-desc">Generate BOQ, PERT-CPM, Gantt, and S-Curve.</span>
                                    </div>
                                </button>
                                <button id="hub-btn-revised-reports" class="btn btn-outline-primary construction-phase-btn" disabled>
                                    <div class="hub-button-content">
                                        <div class="hub-button-header"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/><path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/></svg> <span>Revised Reports</span></div>
                                        <span class="hub-button-desc">View reports updated with approved change orders.</span>
                                    </div>
                                </button>
                                <button id="hub-btn-lookahead" class="btn btn-outline-primary construction-phase-btn" disabled>
                                    <div class="hub-button-content">
                                        <div class="hub-button-header"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0z"/><path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8zm8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z"/></svg> <span>Look-Ahead</span></div>
                                        <span class="hub-button-desc">Plan upcoming tasks and resource requirements.</span>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="takeoff-view" class="hidden">
                <div id="takeoff-quantities-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-takeoff-list" class="btn btn-secondary">&larr; Back to Projects</button>
                            <h1 id="quantities-project-name"></h1>
                        </div>
                        <button id="add-quantity-btn" class="btn btn-primary">Add Quantity</button>
                    </header>
                    <div class="table-container">
                        <table id="quantities-table">
                            <thead>
                                <tr>
                                    <th>Scope of Work</th>
                                    <th>Quantity</th>
                                    <th>Unit</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="dupa-view" class="hidden">
                <div id="dupa-quantity-list-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-dupa-projects" class="btn btn-secondary">&larr; Back to Projects</button>
                            <h1 id="dupa-project-name"></h1>
                        </div>
                    </header>
                    <div id="dupa-quantities-list" class="list-container"></div>
                </div>
            <div id="dupa-form-view" class="hidden">
                <header class="page-header">
                    <div>
                        <button id="back-to-dupa-quantities" class="btn btn-secondary">&larr; Back to Quantities</button>
                        <h2 id="dupa-quantity-name"></h2>
                    </div>
                </header>
                <form id="dupa-form">
                    <input type="hidden" id="dupaQuantityId">
                    <input type="hidden" id="dupaId">
                    <div class="form-group">
                        <label for="dupaDuration">Duration (Days)</label>
                        <input type="number" id="dupaDuration" step="1" min="0" required>
                    </div>
                    <div class="dupa-section">
                        <h3 style="display: flex; justify-content: space-between;">
                            <span>Direct Costs</span>
                            <span id="total-direct-cost-summary" class="cost-summary"></span>
                        </h3>

                        <h4 style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Labor</span>
                            <span id="labor-subtotal" class="cost-summary"></span>
                        </h4>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1rem;">
                            <button type="button" id="add-labor-btn" class="btn-add" title="Add Blank Row">+</button>
                            <button type="button" id="add-labor-from-library-btn" class="btn btn-secondary btn-sm">Add Labor from Library</button>
                            <button type="button" id="add-crew-from-library-btn" class="btn btn-secondary btn-sm">Add Crew from Library</button>
                        </div>
                        <table class="dupa-table"><thead><tr><th>Labor Type</th><th>Mandays</th><th>Rate (PHP)</th><th>Total</th><th></th></tr></thead><tbody id="labor-tbody"></tbody></table>

                        <h4 style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Materials</span>
                            <span id="material-subtotal" class="cost-summary"></span>
                        </h4>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1rem;">
                            <button type="button" id="add-material-btn" class="btn-add" title="Add Blank Row">+</button>
                            <button type="button" id="add-material-from-library-btn" class="btn btn-secondary btn-sm">Add Material from Library</button>
                        </div>
                        <table class="dupa-table"><thead><tr><th>Material Name</th><th>Qty</th><th>Unit</th><th>Unit Price (PHP)</th><th>Total</th><th></th></tr></thead><tbody id="material-tbody"></tbody></table>

                        <h4 style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Equipment</span>
                            <span id="equipment-subtotal" class="cost-summary"></span>
                        </h4>
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 1rem;">
                            <button type="button" id="add-equipment-btn" class="btn-add" title="Add Blank Row">+</button>
                            <button type="button" id="add-equipment-from-library-btn" class="btn btn-secondary btn-sm">Add Equipment from Library</button>
                        </div>
                        <table class="dupa-table"><thead><tr><th>Equipment Name</th><th>Hours</th><th>Rate (PHP)</th><th>Total</th><th></th></tr></thead><tbody id="equipment-tbody"></tbody></table>
                    </div>
                    <div class="dupa-section">
                        <h3 style="display: flex; justify-content: space-between;">
                            <span>Indirect Costs</span>
                            <span id="total-indirect-cost-summary" class="cost-summary"></span>
                        </h3>
                        <div class="indirect-grid" style="grid-template-columns: auto 150px 1fr; gap: 1rem 2rem;">
                            <label for="ocmPercent">OCM (%)</label>
                            <input type="number" id="ocmPercent" step="0.01" min="0" placeholder="e.g., 15">
                            <span id="ocm-amount" class="cost-summary"></span>
                            
                            <label for="profitPercent">Contractor's Profit (%)</label>
                            <input type="number" id="profitPercent" step="0.01" min="0" placeholder="e.g., 10">
                            <span id="profit-amount" class="cost-summary"></span>

                            <label for="taxesPercent">Taxes (%)</label>
                            <input type="number" id="taxesPercent" step="0.01" min="0" placeholder="e.g., 5">
                            <span id="tax-amount" class="cost-summary"></span>
                        </div>
                    </div>

                    <div class="dupa-section">
                        <h3>Summary</h3>
                        <div class="indirect-grid" style="grid-template-columns: auto 1fr;">
                            <strong>Grand Total</strong> <span id="summary-grand-total" class="cost-summary"></span>
                            <strong>Quantity</strong> <span id="summary-quantity" class="cost-summary" style="text-align: right;"></span>
                            <strong>Final Unit Price</strong> <span id="summary-unit-price" class="cost-summary"></span>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Save DUPA</button>
                </form>
            </div>
            </div>

            <div id="sequencing-view" class="hidden">
                <div id="sequencing-tasks-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-sequencing-projects" class="btn btn-secondary">&larr; Back to Projects</button>
                            <h1 id="sequencing-project-name"></h1>
                        </div>
                        <div class="report-controls" style="padding: 0; background: none;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <select id="sequence-group" class="btn btn-secondary">
                                    <option value="none">Group by: None</option>
                                    <option value="category">Group by: Category</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <select id="sequence-sort" class="btn btn-secondary">
                                    <option value="schedule">Sort by: Schedule</option>
                                    <option value="name">Sort by: Name (A-Z)</option>
                                </select>
                            </div>
                        </div>
                    </header>
                    <div class="sequencing-layout">
                        <div class="sequencing-main-panel">
                            <div class="sequencing-section">
                                <h3>Project Sequence Overview</h3>
                                <div class="table-container">
                                    <table id="sequences-overview-table">
                                        <thead>
                                            <tr>
                                                <th>Predecessors</th>
                                                <th>Task</th>
                                                <th>Successors</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="sequences-overview-tbody"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <aside class="sequencing-side-panel">
                            <div class="sequencing-section">
                                <h4>Unsequenced Tasks</h4>
                                <ul id="unsequenced-tasks-list"></ul>
                            </div>
                        </aside>
                    </div>
                </div>
            </div>

            <div id="reports-view" class="hidden">
                <div id="boq-display-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-boq-projects" class="btn btn-secondary">&larr; Back to Projects</button>
                            <h1 id="boq-project-name"></h1>
                            <p id="boq-status-message" class="status-message"></p>
                        </div>
                        <div>
                            <button id="view-pert-cpm-btn" class="btn btn-primary hidden">View PERT-CPM</button>
                            <button id="delete-boq-btn" class="btn btn-danger hidden">Delete BOQ & Unlock Data</button>
                        </div>
                    </header>
                    <div class="table-container">
                        <table id="boq-table">
                            <thead>
                                <tr>
                                    <th>Scope of Work</th>
                                    <th>Quantity</th>
                                    <th>Unit</th>
                                    <th>Unit Price</th>
                                    <th>Total Amount</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="boq-tbody"></tbody>
                            <tfoot id="boq-tfoot"></tfoot>
                        </table>
                    </div>
                </div>
                <div id="pert-cpm-display-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-boq-view" class="btn btn-secondary">&larr; Back to BOQ</button>
                            <h1 id="pert-cpm-project-name"></h1>
                        </div>
                        <div>
                            <button id="view-gantt-chart-btn" class="btn btn-primary">View Gantt Chart</button>
                            <button id="view-s-curve-btn" class="btn btn-primary">View S-Curve</button>
                            <button id="view-network-diagram-btn" class="btn btn-primary">View Network Diagram</button>
                            <button id="view-resource-schedule-btn" class="btn btn-primary">Resource Schedule</button>
                        </div>
                    </header>
                    <div class="table-container">
                        <table id="pert-cpm-table">
                            <thead>
                                <tr>
                                    <th>Task (Scope of Work)</th>
                                    <th>Duration</th>
                                    <th>Early Start (ES)</th>
                                    <th>Early Finish (EF)</th>
                                    <th>Late Start (LS)</th>
                                    <th>Late Finish (LF)</th>
                                    <th>Slack</th>
                                </tr>
                            </thead>
                            <tbody id="pert-cpm-tbody"></tbody>
                        </table>
                    </div>
                </div>
                <div id="gantt-chart-display-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-pert-cpm-view" class="btn btn-secondary">&larr; Back to PERT-CPM</button>
                            <h1 id="gantt-chart-project-name"></h1>
                        </div>
                        <div class="gantt-controls">
                            <div class="form-group" style="margin-bottom: 0;">
                                <select id="reports-gantt-sort" class="btn btn-secondary">
                                    <option value="start_date">Sort by Start Date</option>
                                    <option value="name">Sort by Name</option>
                                    <option value="duration">Sort by Duration</option>
                                </select>
                            </div>
                            <span>View Mode:</span>
                            <button id="gantt-view-day" class="btn btn-secondary">Day</button>
                            <button id="gantt-view-week" class="btn btn-secondary">Week</button>
                            <button id="gantt-view-month" class="btn btn-secondary">Month</button>
                        </div>
                    </header>
                    <div class="gantt-chart-container" id="gantt-chart-target"></div>
                </div>
                <div id="s-curve-display-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-pert-cpm-view-from-s-curve" class="btn btn-secondary">&larr; Back to PERT-CPM</button>
                            <h1 id="s-curve-project-name"></h1>
                        </div>
                    </header>
                    <div class="chart-container">
                        <canvas id="s-curve-chart"></canvas>
                    </div>
                </div>
                <div id="pert-cpm-network-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-pert-cpm-from-network-btn" class="btn btn-secondary">&larr; Back to PERT-CPM</button>
                            <h1 id="network-diagram-project-name"></h1>
                        </div>
                    </header>
                    <div class="mermaid-container">
                        <div class="mermaid"></div>
                    </div>
                </div> 
                <div id="resource-schedule-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-pert-cpm-from-resource-btn" class="btn btn-secondary">&larr; Back to PERT-CPM</button>
                            <h1 id="resource-schedule-project-name"></h1>
                        </div>
                    </header>
                    <div class="table-container" id="resource-schedule-container"></div>
                </div>
            </div>

            <div id="change-orders-view" class="hidden">
                <div id="co-list-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-co-projects" class="btn btn-secondary">&larr; Back to Projects</button>
                            <h1 id="co-project-name"></h1>
                        </div>
                        <button id="add-co-btn" class="btn btn-primary">Add Change Order</button>
                    </header>
                    <div class="table-container">
                        <table id="co-table">
                            <thead><tr><th>Order #</th><th>Description</th><th>Date</th><th>Status</th><th>Amount</th><th>Actions</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="revised-reports-view" class="hidden">
                <div id="revised-boq-display-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-revised-boq-projects" class="btn btn-secondary">&larr; Back to Projects</button>
                            <h1 id="revised-boq-project-name"></h1>
                        </div>
                        <div>
                            <button id="view-revised-pert-cpm-btn" class="btn btn-primary">View Revised PERT-CPM</button>
                        </div>
                    </header>
                    <div class="table-container" id="revised-boq-table-container"></div>
                </div>
                <div id="revised-pert-cpm-display-view" class="hidden">
                    <header class="page-header">
                        <div>
                           <button id="back-to-revised-boq-view" class="btn btn-secondary">&larr; Back to Revised BOQ</button>
                           <h1 id="revised-pert-cpm-project-name"></h1>
                        </div>
                        <div>
                           <button id="view-revised-network-diagram-btn" class="btn btn-primary">View Network Diagram</button>
                           <button id="view-revised-resource-schedule-btn" class="btn btn-primary">Resource Schedule</button>
                        </div>
                    </header>
                    <div class="table-container" id="revised-pert-cpm-table-container"></div>
                </div>
                <div id="revised-pert-cpm-network-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-revised-pert-cpm-from-network-btn" class="btn btn-secondary">&larr; Back to Revised PERT-CPM</button>
                            <h1 id="revised-network-diagram-project-name"></h1>
                        </div>
                    </header>
                    <div class="mermaid-container">
                        <div class="mermaid"></div>
                    </div>
                </div>
                <div id="revised-resource-schedule-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-revised-pert-cpm-from-resource-btn" class="btn btn-secondary">&larr; Back to Revised PERT-CPM</button>
                            <h1 id="revised-resource-schedule-project-name"></h1>
                        </div>
                    </header>
                    <div class="table-container" id="revised-resource-schedule-container"></div>
                </div>
            </div>
            <div id="lookahead-view" class="hidden">
                <div id="lookahead-report-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-lookahead-projects" class="btn btn-secondary">&larr; Back to Projects</button>
                            <h1 id="lookahead-project-name"></h1>
                        </div>
                    </header>

                    <div class="report-controls">
                        <div class="form-group">
                            <label for="lookahead-start-date">Report Start Date</label>
                            <input type="date" id="lookahead-start-date">
                        </div>
                        <div class="form-group">
                            <label for="lookahead-duration">Look-Ahead Period</label>
                            <select id="lookahead-duration">
                                <option value="2">2 Weeks</option>
                                <option value="3" selected>3 Weeks</option>
                                <option value="4">4 Weeks</option>
                            </select>
                        </div>
                        <button id="generate-lookahead-btn" class="btn btn-primary">Generate Report</button>
                    </div>

                    <div id="lookahead-kpi-container"></div>
                    <div id="lookahead-report-content">
                        <p class="placeholder-text">Please select a start date and click "Generate Report" to see the look-ahead schedule.</p>
                    </div>
                </div>
            </div>
            <div id="materials-library-view" class="hidden">
                <header class="page-header">
                    <h1>Materials Library</h1>
                    <button id="add-new-material-btn" class="btn btn-primary">Add New Material</button>
                </header>
                <div class="library-controls">
                    <input type="search" id="material-search-input" placeholder="Search materials...">
                </div>
                <div class="table-container">
                    <table id="materials-table">
                        <thead>
                            <tr>
                                <th>Material Name</th>
                                <th>Unit</th>
                                <th>Unit Price (PHP)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="dupa-library-view" class="hidden">
                <header class="page-header">
                    <h1>DUPA Labor & Equipment Library</h1>
                </header>
                
                <div class="library-section">
                    <div class="page-header">
                        <h2>Resources (Individual Labor & Equipment)</h2>
                        <button id="add-new-resource-btn" class="btn btn-primary">Add New Resource</button>
                    </div>
                    <div class="library-controls">
                        <input type="search" id="resource-search-input" placeholder="Search resources...">
                    </div>
                    <div class="table-container">
                        <table id="resources-table">
                            <thead>
                                <tr>
                                    <th>Resource Name</th>
                                    <th>Type</th>
                                    <th>Rate (PHP)</th>
                                    <th>Unit</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div class="library-section">
                    <div class="page-header">
                        <h2>Crews (Pre-defined Teams)</h2>
                        <button id="add-new-crew-btn" class="btn btn-primary">Add New Crew</button>
                    </div>
                    <div class="library-controls">
                        <input type="search" id="crew-search-input" placeholder="Search crews...">
                    </div>
                    <div class="table-container">
                        <table id="crews-table">
                            <thead>
                                <tr>
                                    <th>Crew Name</th>
                                    <th>Productivity</th>
                                    <th style="width: 280px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="library-management-view" class="hidden">
                <header class="page-header">
                    <h1>Import/Export Library</h1>
                </header>

                <div class="library-section">
                    <h2>Export Library</h2>
                    <p>Save your entire Materials, Resources, and Crews library.</p>
                    <button id="export-library-btn" class="btn btn-primary">Export to File</button>
                    <button id="export-library-gdrive-btn" class="btn btn-secondary">Export to Google Drive</button>
                </div>

                <div class="library-section">
                    <h2>Import Library</h2>
                    <p>Load a previously saved library. Importing will give you the option to merge new items or overwrite existing ones.</p>
                    <input type="file" id="import-library-input" class="hidden" accept=".json">
                    <button id="import-library-btn" class="btn btn-secondary">Import from File</button>
                    <button id="import-library-gdrive-btn" class="btn btn-secondary">Import from Google Drive</button>
                </div>
            </div>

            <div id="material-modal" class="modal">
                <div class="modal-content">
                    <span class="close-button material-modal-close">&times;</span>
                    <h2 id="material-modal-title">Add New Material</h2>
                    <form id="material-form">
                        <input type="hidden" id="material-id">
                        <div class="form-group"><label for="material-name">Material Name</label><input type="text" id="material-name" required></div>
                        <div class="form-group"><label for="material-unit">Unit (e.g., kg, pcs, cu.m)</label><input type="text" id="material-unit" required></div>
                        <div class="form-group"><label for="material-price">Unit Price (PHP)</label><input type="number" step="any" id="material-price" required></div>
                        <button type="submit" class="btn btn-primary">Save Material</button>
                    </form>
                </div>
            </div>

            <div id="resource-modal" class="modal">
                <div class="modal-content">
                    <span class="close-button resource-modal-close">&times;</span>
                    <h2 id="resource-modal-title">Add New Resource</h2>
                    <form id="resource-form">
                        <input type="hidden" id="resource-id">
                        <div class="form-group"><label for="resource-name">Resource Name (e.g., Mason, Excavator)</label><input type="text" id="resource-name" required></div>
                        <div class="form-group">
                            <label for="resource-type">Type</label>
                            <select id="resource-type" required>
                                <option value="labor">Labor</option>
                                <option value="equipment">Equipment</option>
                            </select>
                        </div>
                        <div class="form-group"><label for="resource-rate">Rate (PHP)</label><input type="number" step="any" id="resource-rate" required></div>
                        <div class="form-group"><label for="resource-unit">Unit (e.g., manday, hour)</label><input type="text" id="resource-unit" required></div>
                        <button type="submit" class="btn btn-primary">Save Resource</button>
                    </form>
                </div>
            </div>

            <div id="crew-modal" class="modal">
                <div class="modal-content" style="max-width: 800px;">
                    <span class="close-button crew-modal-close">&times;</span>
                    <h2 id="crew-modal-title">Add New Crew</h2>
                    <form id="crew-form">
                        <input type="hidden" id="crew-id">
                        <div class="form-group"><label for="crew-name">Crew Name (e.g., Concrete Pouring Team)</label><input type="text" id="crew-name" required></div>
                        <div class="form-group"><label for="crew-productivity-rate">Productivity Rate (e.g., 10)</label><input type="number" step="any" id="crew-productivity-rate" required></div>
                        <div class="form-group"><label for="crew-productivity-unit">Productivity Unit (e.g., cu.m/day)</label><input type="text" id="crew-productivity-unit" required></div>
                        
                        <hr style="margin: 2rem 0;">

                        <div class="composition-editor">
                        <div class="resource-list-panel">
                            <h4>Available Resources</h4>
                            <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
                                <input type="search" class="composition-search" id="available-resource-search" placeholder="Search all..." style="flex-grow: 1; margin-bottom: 0;">
                                <button type="button" id="crew-modal-add-labor-btn" class="btn btn-secondary btn-sm" title="Show only Labor resources">Add Labor</button>
                            </div>
                            <ul id="available-resources-list"></ul>
                        </div>
                            <div class="resource-list-panel">
                                <h4>Resources in this Crew</h4>
                                <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                                    <table id="crew-composition-table">
                                        <thead>
                                            <tr>
                                                <th>Resource</th>
                                                <th>Quantity</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" style="margin-top: 1.5rem;">Save Crew</button>
                    </form>
                </div>
            </div>
            <div id="accomplishment-view" class="hidden">
                <div id="accomplishment-entry-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-accomplishment-projects" class="btn btn-secondary">&larr; Back to Projects</button>
                            <h1 id="accomplishment-project-name"></h1>
                        </div>
                        <div class="report-controls" style="padding: 0; background: none;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="accomplishment-group" style="display: none;">Group By</label>
                                <select id="accomplishment-group" class="btn btn-secondary">
                                    <option value="none">Group by: None</option>
                                    <option value="category">Group by: Category</option>
                                </select>
                            </div>
                            <div class="form-group" style="margin-bottom: 0;">
                                <label for="accomplishment-sort" style="display: none;">Sort By</label>
                                <select id="accomplishment-sort" class="btn btn-secondary">
                                    <option value="schedule">Sort by: Schedule</option>
                                    <option value="name">Sort by: Name (A-Z)</option>
                                    <option value="progress">Sort by: Progress (Lowest)</option>
                                </select>
                            </div>
                            <button id="view-past-reports-btn" class="btn btn-primary">View Past Reports</button>
                        </div>
                    </header>
                    <form id="accomplishment-form" class="form-group">
                        <label for="accomplishment-date">Accomplishment Date:</label>
                        <input type="date" id="accomplishment-date" required>
                        <div class="table-container" style="margin-top: 1.5rem;">
                            <table id="accomplishment-table">
                                <thead>
                                    <tr>
                                        <th>Scope of Work</th>
                                        <th>Overall Progress (%)</th>
                                        <th>Progress Today (%)</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                        <button type="submit" class="btn btn-primary" style="margin-top: 1.5rem;">Save Report</button>
                    </form>
                </div>
            </div>
            <div id="accomplishment-list-view" class="hidden">
                <header class="page-header">
                    <div>
                        <button id="back-to-accomplishment-entry" class="btn btn-secondary">&larr; Back to Report Entry</button>
                        <h1 id="accomplishment-list-project-name"></h1>
                    </div>
                </header>
                <div class="table-container">
                    <table id="accomplishment-history-table">
                        <thead>
                            <tr>
                                <th>Report Date</th>
                                <th>Progress Reported This Day</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="accomplishment-detail-view" class="hidden">
                <header class="page-header">
                    <div>
                        <button id="back-to-accomplishment-list" class="btn btn-secondary">&larr; Back to Report List</button>
                        <h1 id="accomplishment-detail-title"></h1>
                    </div>
                    <button id="edit-accomplishment-btn" class="btn btn-warning">Edit This Report</button>
                </header>
                <div class="table-container">
                    <table id="accomplishment-detail-table">
                        <thead>
                            <tr>
                                <th>Scope of Work</th>
                                <th>Progress Recorded on this Date (%)</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="tracking-gantt-view" class="hidden">
                <div id="tracking-gantt-chart-view" class="hidden">
                     <header class="page-header">
                        <div>
                            <button id="back-to-tracking-gantt-projects" class="btn btn-secondary">&larr; Back to Projects</button>
                            <h1 id="tracking-gantt-project-name"></h1>
                        </div>
                        <div class="gantt-controls">
                            <div class="form-group" style="margin-bottom: 0;">
                                <select id="tracking-gantt-sort" class="btn btn-secondary">
                                    <option value="start_date">Sort by Start Date</option>
                                    <option value="name">Sort by Name</option>
                                    <option value="progress">Sort by Progress</option>
                                </select>
                            </div>
                            <span>View Mode:</span>
                            <button id="tracking-gantt-view-day" class="btn btn-secondary">Day</button>
                            <button id="tracking-gantt-view-week" class="btn btn-secondary">Week</button>
                            <button id="tracking-gantt-view-month" class="btn btn-secondary">Month</button>
                        </div>
                    </header>
                    <div class="gantt-chart-container" id="tracking-gantt-chart-target"></div>
                </div>
            </div>

            <div id="tracking-s-curve-view" class="hidden">
                <div id="tracking-s-curve-chart-view" class="hidden">
                    <header class="page-header">
                        <div>
                            <button id="back-to-tracking-s-curve-projects" class="btn btn-secondary">&larr; Back to Projects</button>
                            <h1 id="tracking-s-curve-project-name"></h1>
                        </div>
                    </header>
                    <div class="chart-container">
                        <canvas id="tracking-s-curve-chart"></canvas>
                    </div>
                </div>
            </div>
            <div id="data-management-view" class="hidden">
                <header class="page-header">
                    <h1>Data Management</h1>
                </header>

                <div class="library-section">
                    <h2>Full Application Backup</h2>
                    <p>Export all projects and library data into a single backup file. This is useful for migrating your data to another computer.</p>
                    <button id="export-all-data-btn" class="btn btn-primary">Export Full Backup</button>
                </div>

                <div class="library-section">
                    <h2>Import from Backup</h2>
                    <p>Restore the application from a full backup file. <strong>Warning:</strong> This will overwrite all existing data in the application.</p>
                    <input type="file" id="import-all-data-input" class="hidden" accept=".json">
                    <button id="import-all-data-btn" class="btn btn-secondary">Import from Backup File</button>
                </div>

                <div class="library-section">
                    <h2>Reset Application</h2>
                    <p style="color: var(--danger-color); font-weight: bold;">EXTREME DANGER: This will permanently delete all data from your browser, including all projects and libraries. This action cannot be undone.</p>
                    <button id="reset-all-data-btn" class="btn btn-danger">Reset All Application Data</button>
                </div>
            </div>
        </main>
        <footer class="app-footer">
            <p>¬© 2025 Momentum alpha 2.0 | Daniel Pollentes. All Rights Reserved.</p>
        </footer>

        <div id="project-modal" class="modal">
            <div class="modal-content">
                <span class="close-button project-modal-close">&times;</span>
                <h2 id="modal-title">Add Project</h2>
                <form id="project-form">
    <input type="hidden" id="projectId">
    <div class="form-group"><label for="projectName">Project Name</label><input type="text" id="projectName" required></div>
    <div class="form-group"><label for="projectAddress">Address</label><input type="text" id="projectAddress" required></div>
    <div class="form-group"><label for="clientName">Client Name</label><input type="text" id="clientName" required></div>
    <div class="form-group"><label for="projectDescription">Project Description</label><textarea id="projectDescription" rows="4"></textarea></div>
    
    <div class="details-grid">
        <div class="form-group"><label for="lotArea">Lot Area (m¬≤)</label><input type="number" step="any" id="lotArea"></div>
        <div class="form-group"><label for="floorArea">Total Floor Area (m¬≤)</label><input type="number" step="any" id="floorArea"></div>
        <div class="form-group"><label for="numFloors">Number of Floors</label><input type="number" step="1" id="numFloors"></div>
        <div class="form-group"><label for="contractAmount">Contract Amount (PHP)</label><input type="number" step="any" id="contractAmount"></div>
        <div class="form-group"><label for="targetStartDate">Target Start Date</label><input type="date" id="targetStartDate"></div>
        <div class="form-group"><label for="contractDuration">Contract Duration (Days)</label><input type="number" step="1" id="contractDuration"></div>
        <div class="form-group"><label for="contractDate">Contract Date</label><input type="date" id="contractDate"></div>
        <div class="form-group"><label for="projectManager">Project Manager</label><input type="text" id="projectManager"></div>
        <div class="form-group"><label for="clientContact">Client Contact</label><input type="text" id="clientContact"></div>
    </div>

    <div class="form-group">
        <label for="projectStatus">Project Status</label>
        <select id="projectStatus">
            <option value="On-Going">On-Going</option>
            <option value="Bidding">Bidding</option>
            <option value="On-Hold">On-Hold</option>
            <option value="Completed">Completed</option>
            <option value="Cancelled">Cancelled</option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Save Project</button>
</form>
            </div>
        </div>
        <div id="quantity-modal" class="modal">
            <div class="modal-content">
                <span class="close-button quantity-modal-close">&times;</span>
                <h2 id="quantity-modal-title">Add Quantity</h2>
                <form id="quantity-form">
    <input type="hidden" id="quantityId">
    <div class="form-group"><label for="category">Category</label><input type="text" id="category" list="category-list" placeholder="e.g., Concrete, Framing, Finishes" required><datalist id="category-list"></datalist></div>
    <div class="form-group"><label for="scopeOfWork">Scope of Work (Main Item)</label><input type="text" id="scopeOfWork" required></div>
    <div class="form-group"><label for="unit">Unit (e.g., m¬≤, ft, pcs)</label><input type="text" id="unit" required></div>
    <div class="form-group"><label for="quantity">Total Quantity</label><input type="number" step="any" id="quantity" required></div>
    
    <hr>
    
    <div class="sub-items-section">
        <div class="page-header" style="margin-bottom: 1rem;">
            <h4 style="margin: 0;">Sub-Quantities (Optional Breakdown *Not Yet Implemented*)</h4>
            <button type="button" id="add-subquantity-btn" class="btn btn-secondary" disabled>Add Sub-Item</button>
        </div>
        <p style="font-size: 0.9rem; color: var(--grey-color); margin-top: -1rem; margin-bottom: 1rem;">If you add sub-items here, the "Total Quantity" above will be automatically calculated from their sum.</p>
        <div class="table-container">
            <table id="subquantities-table">
                <thead>
                    <tr>
                        <th>Sub-Item Name</th>
                        <th>Quantity</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    
    <hr>
    <button type="submit" class="btn btn-primary">Save Quantity</button>
</form>
            </div>
        </div>
        <div id="sequence-edit-modal" class="modal">
            <div class="modal-content">
                <span class="close-button sequence-modal-close">&times;</span>
                <h2 id="sequence-modal-title">Edit Sequence</h2>
                <form id="sequence-edit-form">
                    <input type="hidden" id="editingTaskId">
                    <div class="sequencing-section">
                        <p>Select one or more tasks that must happen <strong>before</strong> or <strong>after</strong> this task.</p>
                        <div class="sequence-links-grid">
                            <div>
                                <label for="modal-predecessors-multiselect">Precedents (come before)</label>
                                <select id="modal-predecessors-multiselect" multiple></select>
                            </div>
                            <div>
                                <label for="modal-successors-multiselect">Successors (come after)</label>
                                <select id="modal-successors-multiselect" multiple></select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Links</button>
                    </div>
                </form>
            </div>
        </div>
        <div id="copy-project-modal" class="modal">
            <div class="modal-content">
                <span class="close-button copy-project-modal-close">&times;</span>
                <h2>Copy Project</h2>
                <form id="copy-project-form">
                    <div class="form-group">
                        <label for="source-project-select">Source Project</label>
                        <select id="source-project-select" required></select>
                    </div>
                    <div class="form-group">
                        <label for="new-project-name-copy">New Project Name</label>
                        <input type="text" id="new-project-name-copy" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Copy Project</button>
                </form>
            </div>
        </div>
        <div id="dupa-details-modal" class="modal">
            <div class="modal-content">
                <span class="close-button dupa-details-modal-close">&times;</span>
                <h2 id="dupa-details-title">DUPA Breakdown</h2>
                <div id="dupa-details-content"></div>
            </div>
        </div>
        <div id="co-modal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <span class="close-button co-modal-close">&times;</span>
                <h2 id="co-modal-title">New Change Order</h2>
                <form id="co-form">
                    <input type="hidden" id="co-id">
                    <div class="form-group"><label for="co-description">Description</label><input type="text" id="co-description" required></div>
                    <div class="form-group"><label for="co-date">Date</label><input type="date" id="co-date" required></div>
                    <div class="form-group"><label for="co-status">Status</label><select id="co-status"><option value="Pending">Pending</option><option value="Approved">Approved</option><option value="Rejected">Rejected</option></select></div>
                    
                    <h4 style="margin-top:2rem; border-top:1px solid #ccc; padding-top:1rem;">Line Items</h4>
                    <div class="table-container">
                        <table id="co-items-table">
                            <thead><tr><th>Scope of Work</th><th>Qty</th><th>Unit</th><th>Amount</th><th>Actions</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <button type="button" id="add-co-item-btn" class="btn btn-secondary" style="margin-top:1rem;">Add Item</button>
                    <hr>
                    <button type="submit" class="btn btn-primary">Save Change Order</button>
                </form>
            </div>
        </div>
        <div id="co-item-dupa-modal" class="modal">
            <div class="modal-content">
                <span class="close-button co-item-dupa-modal-close">&times;</span>
                <h2 id="co-item-dupa-title">Cost Breakdown for Item</h2>
                <form id="co-item-dupa-form">
                     <input type="hidden" id="co-item-id">
                     <input type="hidden" id="co-original-quantity-id">
                     <div class="form-group"><label for="co-item-scope">Scope of Work</label><input type="text" id="co-item-scope" required></div>
                     <div class="form-group"><label for="co-item-quantity">Quantity</label><input type="number" step="any" id="co-item-quantity" required></div>
                     <div class="form-group"><label for="co-item-unit">Unit</label><input type="text" id="co-item-unit" required></div>
                     <hr>
                     <div class="form-group"><label for="co-item-dupa-duration">Duration (Days)</label><input type="number" id="co-item-dupa-duration" step="1" min="0" required></div>
                     <div class="dupa-section">
                        <h4 style="margin-top: 0;">Direct Costs</h4>
                        <h5>Labor <button type="button" id="co-add-labor-btn" class="btn-add">+</button></h5>
                        <table class="dupa-table"><thead><tr><th>Labor Type</th><th>Mandays</th><th>Rate (PHP)</th><th></th></tr></thead><tbody id="co-labor-tbody"></tbody></table>
                        <h5>Materials <button type="button" id="co-add-material-btn" class="btn-add">+</button></h5>
                        <table class="dupa-table"><thead><tr><th>Material Name</th><th>Qty</th><th>Unit</th><th>Unit Price (PHP)</th><th></th></tr></thead><tbody id="co-material-tbody"></tbody></table>
                        <h5>Equipment <button type="button" id="co-add-equipment-btn" class="btn-add">+</button></h5>
                        <table class="dupa-table"><thead><tr><th>Equipment Name</th><th>Hours</th><th>Rate (PHP)</th><th></th></tr></thead><tbody id="co-equipment-tbody"></tbody></table>
                    </div>
                     <div class="form-group"><label for="co-item-dupa-ocm">OCM (%)</label><input type="number" step="any" id="co-item-dupa-ocm" value="10"></div>
                     <div class="form-group"><label for="co-item-dupa-profit">Profit (%)</label><input type="number" step="any" id="co-item-dupa-profit" value="15"></div>
                     <div class="form-group"><label for="co-item-dupa-taxes">Taxes (%)</label><input type="number" step="any" id="co-item-dupa-taxes" value="5"></div>
                     <button type="submit" class="btn btn-primary">Save Item Details</button>
                </form>
            </div>
        </div>
        <div id="co-item-type-modal" class="modal">
            <div class="modal-content">
                <span class="close-button co-item-type-modal-close">&times;</span>
                <h2>Select Item Type</h2>
                <p>Is this a new scope of work, or are you modifying an existing item from the original contract?</p>
                <div style="display: flex; justify-content: space-around; margin-top: 2rem;">
                    <button type="button" id="co-select-new-item-btn" class="btn btn-primary">New Scope Item</button>
                    <button type="button" id="co-select-existing-item-btn" class="btn btn-secondary">Modify Existing Item</button>
                </div>
            </div>
        </div>
        <div id="co-existing-item-modal" class="modal">
            <div class="modal-content">
                <span class="close-button co-existing-item-modal-close">&times;</span>
                <h2>Modify Existing Scope Item</h2>
                <form id="co-existing-item-form">
                    <div class="form-group">
                        <label for="co-original-item-select">Original Scope Item</label>
                        <select id="co-original-item-select" required></select>
                    </div>
                    <div class="form-group">
                        <label for="co-item-quantity-change">Quantity Change (use a negative number for deduction)</label>
                        <input type="number" step="any" id="co-item-quantity-change" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Modification</button>
                </form>
            </div>
        </div>
        
    

        <div id="delete-boq-modal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="close-delete-boq-modal">&times;</span>
                <h2>Confirm Deletion</h2>
                <p><strong>Warning:</strong> Are you sure you want to permanently delete this locked BOQ?</p>
                <p>This will unlock all pre-construction data (Quantities, DUPAs) and permanently delete all construction progress (Accomplishment Reports) for this project. <strong>This action cannot be undone.</strong></p>
                <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem;">
                    <button id="cancel-delete-boq-btn" class="btn btn-secondary">Cancel</button>
                    <button id="confirm-delete-boq-btn" class="btn btn-danger">Confirm & Delete</button>
                </div>
            </div>
        </div>
        <div id="generate-boq-modal" class="modal">
        <div class="modal-content">
                <span class="close-button" id="close-generate-boq-modal">&times;</span>
                <h2>Generate Bill of Quantities?</h2>
                <p>No locked BOQ was found for this project.</p>
                <p><strong>Warning:</strong> Generating a BOQ will lock all pre-construction data (Quantities and DUPAs) for this project. You will NOT be able to edit them after this point unless you delete the BOQ.</p>
                <p>Are you sure you want to proceed?</p>
                <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem;">
                    <button id="cancel-generate-boq-btn" class="btn btn-secondary">Cancel</button>
                    <button id="confirm-generate-boq-btn" class="btn btn-primary">Generate & Lock BOQ</button>
                </div>
            </div>
        </div>
        <div id="start-date-modal" class="modal">
            <div class="modal-content">
                <h2>Project Start Date Required</h2>
                <p>This is the first accomplishment report for this project. Please set the project's official start date to continue.</p>
                <div class="form-group">
                    <label for="modal-start-date-input">Project Start Date</label>
                    <input type="date" id="modal-start-date-input" required>
                </div>
                <div style="display: flex; justify-content: flex-end; margin-top: 2rem;">
                    <button id="set-start-date-btn" class="btn btn-primary">Set Date & Continue</button>
                </div>
            </div>
            </div>

        <div id="import-preview-modal" class="modal">
            <div class="modal-content" style="max-width: 700px;">
                <span class="close-button import-preview-modal-close">&times;</span>
                <h2>Import Preview</h2>
                <p>The following items were found in the file. Duplicates are items with a name (or name + type) that already exists in your library.</p>
                <div id="import-preview-content" style="max-height: 40vh; overflow-y: auto; border: 1px solid #eee; padding: 15px; border-radius: 6px;">
                    </div>
                <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem;">
                    <button id="import-cancel-btn" class="btn btn-secondary">Cancel</button>
                    <button id="import-proceed-duplicates-btn" class="btn btn-warning">Import All (Overwrite Duplicates)</button>
                    <button id="import-proceed-new-btn" class="btn btn-primary">Import New Items Only</button>
                </div>
            </div>
        </div>


        <div id="library-picker-modal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="library-picker-modal-close">&times;</span>
                <h2 id="library-picker-title">Select from Library</h2>
                <div class="form-group">
                    <input type="search" id="library-picker-search" placeholder="Search...">
                </div>
                <div id="library-picker-crew-multiplier" class="form-group hidden">
                    <label for="library-picker-crew-count">Number of Crews to Add</label>
                    <input type="number" id="library-picker-crew-count" value="1" min="1" step="1">
                </div>
                <ul id="library-picker-list" class="list-container" style="max-height: 40vh; overflow-y: auto;">
                    </ul>
            </div>
        </div>
        
        <script src="js/dexie.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="js/db.js"></script>
        <script src="js/views.js"></script>
        <script src="js/dashboard.js"></script>
        <script src="js/materials.js"></script>
        <script src="js/dupa_library.js"></script>
        <script src="js/library_management.js"></script>
        <script src="js/projects.js"></script>
        <script src="js/takeoff.js"></script>
        <script src="js/dupa.js"></script>
        <script src="js/sequencing.js"></script>
        <script src="js/construction.js"></script>
        <script src="js/reports.js"></script>
        <script src="js/change_orders.js"></script>
        <script src="js/settings.js"></script>
        <script src="js/data_management.js"></script>
        <script src="js/app.js"></script>
        <script src="js/gdrive.js"></script>
        
        <script src="https://accounts.google.com/gsi/client" onload="gisLoaded()" async defer></script>
        <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()" async defer></script>
    </body>
</html>
